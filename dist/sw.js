importScripts("https://storage.googleapis.com/workbox-cdn/releases/6.5.4/workbox-sw.js");const{precaching,routing,strategies}=workbox,CACHE_NAME="story-app-v1";precaching.precacheAndRoute([{url:"/",revision:null},{url:"/index.html",revision:null},{url:"/favicon.png",revision:null},{url:"/images/logo.png",revision:null},{url:"/images/icons/icon-192x192.png",revision:null},{url:"/images/icons/icon-512x512.png",revision:null},{url:"/manifest.json",revision:null},{url:"/app.bundle.js",revision:null},{url:"/app.webmanifest",revision:null},{url:"styles.css",revision:null}]),routing.registerRoute((({request:e})=>"style"===e.destination),new strategies.CacheFirst({cacheName:"story-app-styles",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:20,maxAgeSeconds:2592e3})]})),routing.registerRoute((({request:e})=>"image"===e.destination),new strategies.CacheFirst({cacheName:"story-app-images",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:60,maxAgeSeconds:2592e3})]})),routing.registerRoute((({request:e})=>"script"===e.destination),new strategies.StaleWhileRevalidate({cacheName:"story-app-scripts"})),routing.registerRoute((({url:e})=>e.href.includes("/v1/stories")),new strategies.StaleWhileRevalidate({cacheName:"story-app-api",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:50,maxAgeSeconds:604800})]})),routing.registerRoute((({request:e})=>"navigate"===e.mode),new strategies.NetworkFirst({cacheName:"story-app-pages",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:30,maxAgeSeconds:604800})]}));let lastNotifiedStoryId=null;self.addEventListener("fetch",(e=>{e.request.url.includes("/v1/stories")?e.respondWith(fetch(e.request).then((async e=>{const t=e.clone();try{const e=await t.json();if(e&&e.stories&&e.stories.length>0){const t=e.stories[0];t.id!==lastNotifiedStoryId&&(lastNotifiedStoryId=t.id,(await self.clients.matchAll()).forEach((e=>{e.postMessage({type:"CHECK_NOTIFICATION_PREFERENCE",story:{id:t.id,name:t.name,description:t.description,photoUrl:t.photoUrl}})})))}}catch(e){console.error("Error processing story data:",e)}return e})).catch((()=>caches.match(e.request)))):e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request).then((t=>{if(t&&200===t.status&&("style"===e.request.destination||"script"===e.request.destination||"image"===e.request.destination||"document"===e.request.destination||"font"===e.request.destination)){const i=t.clone();caches.open(CACHE_NAME).then((t=>{t.put(e.request,i)}))}return t})).catch((()=>"document"===e.request.destination?caches.match("/index.html"):(e.request.url.includes("/v1/stories"),caches.match("/fallback.json")))))))})),self.addEventListener("message",(e=>{if(e.data&&"SHOW_NOTIFICATION"===e.data.type){const{title:t,body:i,url:s,image:n}=e.data;self.registration.showNotification(t,{body:i,icon:"/favicon.png",badge:"/favicon.png",image:n||"/images/logo.png",data:{url:s||"/"}})}})),self.addEventListener("notificationclick",(e=>{e.notification.close();const t=e.notification?.data?.url||"/";e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(const i of e)if(i.url===t&&"focus"in i)return i.focus();if(clients.openWindow)return clients.openWindow(t)})))})),self.addEventListener("install",(e=>{self.skipWaiting()})),self.addEventListener("activate",(e=>{e.waitUntil(clients.claim())}));